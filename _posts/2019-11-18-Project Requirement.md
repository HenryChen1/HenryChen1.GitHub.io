---
layout:     post
title:      "Project Requirement"
subtitle:   "今天也是bug满满的一天呀"
date:       2019-11-18
author:     "Henry"

tags:
    - Study Account
    - Project Requirement
---

## Project Requirement（实时更新）



- [x] 1、从单片机中获取采样数据
- [x] 2、解决为何数据将负数置零了😥
- [x] 3、解决缓存区大小，改用动态分配内存的方法😱
- [ ] 4、**改变RTX实时操作系统的任务调度方式——将数据处理的工作放在任务函数中而不是中断函数中，中断函数只负责接收AD采样点**
  - [x] ① 修改信号量的方式去进行任务调度，将数据直接复制到寄存器中（取消使用队列）
  - [x] ② 将读峰峰值数据处理放到任务函数TimeProc中
    - [x] 修改读峰峰值时对max,min的初始化
    - [ ] 设置阈值触发记录保存波形数据
      - [x] 1.触发阈值标志位放在modbus寄存器6中，初始化为1（置1为可更新，置0为不可更新）
      - [ ] 2.STM32：一达到某个阈值（1500），单片机会触发寄存器读取保存缓冲区以及后面的数据（缓冲区尽可能大——700个点，一共7000个点），然后置0
        - [x] 判断阈值应该在每个缓冲区内（需要减去超过阈值前的数据），然后将后面的数据也要保存进去，再置0
        - [ ] 修改modbus配置（读、写标志位寄存器6）
      - [ ] 3.上位机：上位机判断标志位是否为0，若是，则保存寄存器中的数据后，标志位置1（可更新）；若不是，则等待
      - [x] **判断触发的工作应该是在中断函数里？**
    - [ ] 处理峰峰值数据
  - [ ] ③ 将放电量等的数据处理放到任务函数TimeProc中
- [x] 5、修改上位机中动态分配内存的问题（用vector，直接将寄存器中的数据读出）
- [ ] **6、解决读取波形的数据帧因Modbus协议传输慢而被覆盖部分的问题（设置合理的传输方式——缓冲区，以及传输数量和采样点**

> https://blog.csdn.net/u012878503/article/details/80187876 vector去重不改变顺序